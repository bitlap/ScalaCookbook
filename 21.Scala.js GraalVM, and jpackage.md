# 21. Scala.js、GraalVM和jpackage

Scala.js项目（ *https://www.scala-js.org* ）作为一个强大的、类型安全的JavaScript的替代品，可以让你编写Scala代码替代JavaScript。简而言之，当你需要编写JavaScript时，可以用Scala.js来代替，并使用sbt和Scala.js插件将Scala.js代码编译成JavaScript。就像 **scalac** 把Scala代码编译成能在 JVM 上运行的 *.class* 文件一样，Scala.js插件把Scala代码编译成能在浏览器上运行的JavaScript代码。

Scala.js网站将Scala.js描述为“以更安全的方式构建强大的前端web应用”。Scala.js有很多优点，比如可以使用类、模块、强大的类型系统、大量的类库，以及IDE对简单重构、代码补全等功能的支持，Scala.js是JavaScript以及CoffeeScript、Dart和TypeScript等其他JavaScript的强有力的替代方案。Scala.js可以使用相同工具来编写服务器端和客户端代码。

图21-1总结了Scala.js与其他浏览器技术相比的优势，该图由Scala.js网站提供，转载于此。

本章包括三个Scala.js示例，以帮助你入门：
- 21.1小节展示了如何建立和运行Scala.js环境。
- 在设置好环境后，21.2小节展示了如何编写Scala/Scala.js代码以响应按钮点击之类的事件。
- 然后，21.3小节展示了如何开始编写单页面的Web应用程序。

![](images/ch21/Figure21-1.png)

*图21-1. Scala.js的优点（由scala-js.org提供）*

接下来，21.4小节展示了GraalVM（ *https://www.graalvm.org* ）和它的 **native-image** 命令。顾名思义，这个命令可以把Scala应用程序变成一个native镜像。通过创建一个本地可执行文件 —— 例如Microsoft Windows上的 *.exe* 文件 —— 应用程序将立即启动，而没有JVM应用程序最初启动时的滞后感。

最后，**jpackage** 命令是Java 14 JDK附带的一个优秀工具。它可以把JVM应用程序打包成macOS、Windows和Linux平台上的native应用程序。**jpackage** 适用于任何为JVM生成 *class* 文件的语言，所以21.5小节展示了如何使用它把Scala应用程序打包成native应用程序。

## 21.1 Scala.js入门

### 问题

你想开始使用Scala.js，需要知道如何安装它并创建一个“Hello, world”的例子。

### 解决方案

本小节展示了如何开始使用Scala.js，并假定你熟悉JavaScript、HTML和文档对象模型（DOM）。

开始使用Scala.js是一个多步骤的过程：
1. 处理好先决条件
2. 创建一个使用Scala.js插件的新sbt项目
3. 创建一个Scala/Scala.js文件
4. 编译并运行Scala代码

#### 1. 先决条件

要开始使用Scala.js，你需要在系统上安装这些工具：
- Scala 3 （ *https://www.scala-lang.org* ）
- sbt （1.5.0更高版本） （ *https://www.scala-sbt.org* ）
- Node.js （ *https://nodejs.org/en/download* ）

在macOS系统上，我用 **brew install node** 命令安装了Node.js，但你也可以按照该链接，用它所提供的安装程序来安装它。

#### 2. 创建一个新sbt项目

创建一个新的sbt项目目录结构，如17.1小节“为sbt创建一个项目目录结构”所示。然后编辑 *build.sbt* 文件，改成下面这些内容：
```scala
    ThisBuild / scalaVersion := "3.0.0"

    // enable the plugin that’s in 'project/plugins.sbt'
    enablePlugins(ScalaJSPlugin)

    // this states that this is an application with a main method
    scalaJSUseMainModuleInitializer := true

    lazy val root = project
      .in(file("."))
      .settings(
        name := "ScalaJs Hello World",
        version := "0.1.0"
      )
```

如果你在电脑上跟读，我强烈建议你使用所显示的确切内容，因为它们会影响Scala代码被编译成JavaScript文件时的文件名。

最后，在 *project/plugins.sbt* 文件中添加这行：
```scala
    addSbtPlugin("org.scala-js" % "sbt-scalajs" % "1.5.1")
```

这句话告诉sbt如何下载Scala.js库。

#### 3. 创建一个Scala/Scala.js文件

#### 4. 编译并运行Scala代码

### 讨论

### 另见

## 21.2 使用Scala.js响应事件

### 问题

### 解决方案

### 讨论

### 另见

## 21.3 使用Scala.js构建单页面的应用程序

### 问题

### 解决方案

### 讨论

### 另见

## 21.4 使用GraalVM构建本地可执行文件

### 问题

### 解决方案

### 讨论

### 另见

## 21.5 使用jpackage打包应用程序

### 问题

### 解决方案

### 讨论

### 另见